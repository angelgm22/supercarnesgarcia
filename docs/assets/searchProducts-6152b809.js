import{s as w,_ as p}from"./index-8e493232.js";function f(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim()}function g(e,d){const s=f(e),l=f(d);if(s===l)return 100;if(s.includes(l))return 90;if(l.includes(s))return 85;const i=s.split(/\s+/),n=l.split(/\s+/);let c=0,a=0;n.forEach(o=>{i.some(t=>t===o)?c+=2:i.some(t=>t.includes(o)||o.includes(t))?(c+=1,a+=.5):i.some(t=>t.startsWith(o.slice(0,3))||o.startsWith(t.slice(0,3)))&&(a+=.3)});const r=(c+a)/n.length*70;return Math.min(r,100)}async function h(e,d,s=!1,l=!1){try{console.log("ðŸ” Buscando:",e,"CategorÃ­a:",d);const i=window.userRole||"user";let n=w.from("productos").select(`
        *,
        producto_subcategorias(subcategoria)
      `).order("orden",{ascending:!0});i!=="admin"&&(n=n.eq("activo",!0)),d&&(n=n.eq("categoria",d)),s&&(n=n.neq("categoria","carnes")),l&&(n=n.gt("descuento",0));const{data:c,error:a}=await n;if(a)throw a;const o=(c||[]).map(t=>{let u=0;const y=g(t.nombre,e);if(u+=y*3,t.descripcion){const m=g(t.descripcion,e);u+=m}return t.producto_subcategorias&&Array.isArray(t.producto_subcategorias)&&t.producto_subcategorias.forEach(m=>{if(m.subcategoria){const v=g(m.subcategoria,e);u+=v*2}}),{product:t,score:u}}).filter(t=>t.score>15).sort((t,u)=>u.score-t.score).map(t=>t.product);return console.log("âœ… Resultados encontrados:",o.length),o}catch(i){return console.error("âŒ Error en bÃºsqueda:",i),[]}}function _(e){const d=document.getElementById(e.inputId),s=document.getElementById(e.resultsId),l=document.getElementById(e.gridId);if(!d||!s||!l){console.warn("âš ï¸ Elementos de bÃºsqueda no encontrados:",e);return}console.log("âœ… BÃºsqueda configurada para:",e.inputId),d.addEventListener("input",async i=>{const n=i.target.value.trim();if(n===""){s.classList.add("hidden"),s.innerHTML="";const{setupPagination:a}=await p(()=>import("./index-8e493232.js").then(o=>o.p),["assets/index-8e493232.js","assets/index-a3133e01.css"]);let r="";e.gridId==="meatsGrid"?r="meatsPagination":e.gridId==="productsGrid"?r="productsPagination":e.gridId==="offersGrid"&&(r="offersPagination"),r&&await a(e.gridId,r,e.categoria,e.excludeCarnes,e.onlyOffers);return}if(n.length<1){s.classList.add("hidden");return}const c=await h(n,e.categoria,e.excludeCarnes,e.onlyOffers);c.length>0?(s.innerHTML=c.map(a=>`
          <div class="p-3 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer border-b border-gray-200 dark:border-gray-600 last:border-0 search-result-item" data-id="${a.id}">
            <div class="flex items-center space-x-3">
              <img src="${a.imagen_url||"/placeholder.jpg"}" alt="${a.nombre}" class="w-12 h-12 object-cover rounded">
              <div>
                <p class="font-medium text-gray-900 dark:text-white">${a.nombre}</p>
                <p class="text-sm text-gray-600 dark:text-gray-400">${a.categoria}</p>
              </div>
              ${a.descuento>0?`<span class="ml-auto bg-red-500 text-white px-2 py-1 rounded text-xs">-${a.descuento}%</span>`:""}
            </div>
          </div>
        `).join(""),s.classList.remove("hidden"),s.querySelectorAll(".search-result-item").forEach(a=>{a.addEventListener("click",async()=>{const r=a.getAttribute("data-id");console.log("ðŸŽ¯ Producto seleccionado:",r);const o=c.find(t=>t.id.toString()===r);if(o){const{ProductCard:t}=await p(()=>import("./index-8e493232.js").then(u=>u.P),["assets/index-8e493232.js","assets/index-a3133e01.css"]);l.innerHTML=t({id:o.id,name:o.nombre,description:o.descripcion||"",image:o.imagen_url||"/images/placeholder.jpg",category:o.categoria,discount:o.descuento,activo:o.activo,precio:o.precio,showPrice:!0}),typeof window.updateAdminButtons=="function"&&window.updateAdminButtons(),setTimeout(()=>{l.scrollIntoView({behavior:"smooth",block:"start"})},100)}d.value="",s.classList.add("hidden"),s.innerHTML=""})})):(s.innerHTML=`
        <div class="p-4 text-center text-gray-500 dark:text-gray-400">
          No se encontraron resultados
        </div>
      `,s.classList.remove("hidden"))}),d.addEventListener("keypress",async i=>{if(i.key==="Enter"){i.preventDefault();const n=d.value.trim();if(n.length<2)return;s.classList.add("hidden");const c=await h(n,e.categoria,e.excludeCarnes,e.onlyOffers),a=(await p(()=>import("./index-8e493232.js").then(r=>r.P),["assets/index-8e493232.js","assets/index-a3133e01.css"])).ProductCard;l.innerHTML=c.length?c.map(r=>a({id:r.id,name:r.nombre,description:r.descripcion||"",image:r.imagen_url||"/images/placeholder.jpg",category:r.categoria,discount:r.descuento,activo:r.activo,precio:r.precio,showPrice:!0})).join(""):'<p class="col-span-full text-center text-gray-500 dark:text-gray-400 py-8">No se encontraron productos</p>',typeof window.updateAdminButtons=="function"&&window.updateAdminButtons(),typeof window.setupDragAndDrop=="function"&&setTimeout(()=>{window.setupDragAndDrop()},100)}}),document.addEventListener("click",i=>{!d.contains(i.target)&&!s.contains(i.target)&&s.classList.add("hidden")})}export{h as searchProductsInDB,_ as setupSearch};
